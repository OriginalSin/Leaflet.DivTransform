<!DOCTYPE html>
<html>
<head>
	<title>Leaflet Image Transformation Example</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

	<script src="http://leaflet.github.io/Leaflet.draw/leaflet.draw.js"></script>

	<script src="http://scanex.github.io/Leaflet.imageTransform/src/L.ImageTransform.js"></script>
	<script src="http://scanex.github.io/Leaflet.imageTransform/examples/css/examples.css"></script>

	<script src="../src/L.DivTransform.js"></script>
    
    <style>
        html, body, #map {
            height: 100%;
            width: 100%;
            margin: 0px;
        }
    </style>
</head>
<body>
	<div id="map"></div>

	<script>
		var cloudmadeUrl = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png',
			cloudmade = new L.TileLayer(cloudmadeUrl, {maxZoom: 18}),
			map = new L.Map('map', {layers: [cloudmade], center: new L.LatLng(55.752797, 37.62482), zoom: 15});

        var anchors = [[55.757565, 37.620406], [55.756694, 37.638902], [55.749288, 37.637786], [55.750546, 37.615213]];

		// To modify the anchor points on image
        L.gmxPolygon = L.Polygon.extend({
            disableAddRemovePoints: function () {
                var poly = this.editing._poly;
                for(var key in this.editing._markerGroup._layers) {
                    var marker = this.editing._markerGroup._layers[key];
                    if(marker._index === undefined) marker._icon.style.display = 'none';
                    else {
                        marker.off('click');
                        marker.on('drag', function (ev){poly.fire('drag');}, this);
                    }
                }
            }
        });
        var polygon = new L.gmxPolygon(anchors, { fillOpacity: 0 });
		polygon.editing.enable();
		map.addLayer(polygon);
		polygon.disableAddRemovePoints();
		polygon.on('drag', function(ev) {
            var newAnchors = [];
            for(var i = 0, len = ev.target._latlngs.length; i < len; i++) {
                var marker = ev.target._latlngs[i];
                newAnchors.push([marker.lat, marker.lng]);
            }
            gmxImage.setAnchors(newAnchors);
		});


        var gmxImage = new L.DivTransform('', anchors, {
            opacity: 0.8,
            width: 420,
            height: 315,
            html: '<iframe width="420" height="315" src="//www.youtube.com/embed/MmKITvBaf9o" frameborder="0" allowfullscreen></iframe>'
            //html: '<iframe src="http://player.vimeo.com/video/92251790?wmode=opaque&api=1&autoplay=1" width="900" height="700"  webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>'
        });
        
		map.addLayer(gmxImage);
	</script>
</body>
</html>
